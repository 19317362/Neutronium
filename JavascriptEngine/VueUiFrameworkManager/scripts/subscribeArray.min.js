(function(){function n(n){return!!(n&&n.constructor&&n.call&&n.apply)}var t=function(t,i){function r(n,i){Object.defineProperty(t,n,{value:i})}function d(n,t){var i=n.indexOf(t);i!=-1&&n.splice(i,1)}function a(n){return e.push(n),()=>d(e,n)}function g(){e.forEach(n=>n(f));f=[];h=!1}function nt(n){if(Array.isArray(n)){if(n.length===0)return;f=f.concat(n)}else f.push(n);h!==!0&&(h=!0,setTimeout(g))}function u(n){if(e.length){var t=n();nt(t)}}function v(n,t,i,r){this.index=n;this.value=t;this.status=i;r!==undefined&&(this.moved=r)}function o(n,t,i){return new v(n,t,"deleted",i)}function s(n,t,i){return new v(n,t,"added",i)}function c(n,t,i,r){r.push(o(n,i,t));r.push(s(t,i,n))}function tt(n,t,i){var r=[],u=i;return n.forEach(n=>r.push(o(u++,n))),t.forEach(n=>r.push(s(i++,n))),r}function it(n){var t=[];return n.forEach((n,i)=>t.push(s(i,n))),t}function rt(n){for(var i=[],e=(n.length-1)/2,t=0;t<e;t++){var r=n.length-1-t,u=n[t],f=n[r];u!==f&&(c(t,r,f,i),c(r,t,u,i))}return i}function ut(n,t){var i=String(n),r=String(t);return i.localeCompare(r)}function ft(n){var t=[];return n.forEach((n,i)=>{n.index!==i&&c(n.index,i,n.el,t)}),t}var y,p,w,l,b,k;if(!t||!Array.isArray(t))throw new Error("subject should be an array");if(!i||!n(i))throw new Error("callBack should be a function");if(!!t.addCallBack)return t.addCallBack(i);r("addCallBack",a);var e=[],f=[],h=!1;return y=t.pop,r("pop",function(){var n=y.apply(this,arguments);return u(()=>o(this.length,n)),n}),p=t.push,r("push",function(){var t=arguments[0],n=p.apply(this,arguments);return u(()=>s(n-1,t)),n}),w=t.shift,r("shift",function(){var n=w.apply(this,arguments);return u(()=>o(0,n)),n}),l=t.splice,r("splice",function(n){var t=n<0?this.length+n:n,r,i;return t>this.length&&(t=this.length),r=Array.prototype.slice.call(arguments,2),i=l.apply(this,arguments),u(()=>tt(i,r,t)),i}),b=t.unshift,r("unshift",function(){var n=b.apply(this,arguments);return u(()=>it([].slice.call(arguments))),n}),k=t.reverse,r("reverse",function(){var n=k.apply(this,arguments);return u(()=>rt(this)),n}),r("sort",function(n){var r=this.map((n,t)=>{el:n,index:t}),f=n?(t,i)=>n(t.el,i.el):(n,t)=>ut(n.el,t.el),i=Array.prototype.sort.call(r,f),t=i.map(n=>n.el);return t.unshift(0,this.length),l.apply(this,t),u(()=>ft(i)),t.splice(2)}),a(i)};Object.defineProperty(Array.prototype,"subscribe",{value:function(n){return t(this,n)}})})();